#!/usr/bin/octave-cli --no-window-system
% function mgh2dpv(varargin)
% Convert a MGH/MGZ file generated by FreeSurfer to a DPV
% (curvature) file in ASCII format, with extension .dpv.
%
% Usage:
% mgh2dpv(filevtk,filesrf)
%
% filemgh : Input VTK file.
% filesrf : Output SRF file.
%
% _____________________________________
% Anderson M. Winkler
% FMRIB / Univ. of Oxford
% Oct/2015
% http://brainder.org

% Do OCTAVE stuff
if exist('argv','builtin') && ~ exist('varargin','var')
    
    % Get the inputs
    varargin = argv();
    nargin  = numel(varargin);

    % Disable memory dump on SIGTERM
    sigterm_dumps_octave_core(0);

    % Print usage if no inputs are given
    if isempty(varargin) || strcmp(varargin{1},'-q'),
        fprintf('Convert a MGH/MGZ file generated by FreeSurfer to a DPV\n');
        fprintf('(curvature) file in ASCII format, with extension .dpv.\n');
        fprintf('\n');
        fprintf('Usage:\n');
        fprintf('mgh2dpv <filemgh> <filedpv>\n');
        fprintf('\n');
        fprintf('filemgh : Input MGH/MGZ file.\n');
        fprintf('filedpv : Output DPV file.\n');
        fprintf('\n');
        fprintf('_____________________________________\n');
        fprintf('Anderson M. Winkler\n');
        fprintf('FMRIB / Univ. of Oxford\n');
        fprintf('Oct/2015\n');
        fprintf('http://brainder.org\n');
        return;
    end
end

% Take inputs:
filemgh = varargin{1};
filedpv = varargin{2};

% Check if FS is available:
fshome = getenv('FREESURFER_HOME');
if isempty(fshome),
    error([
        'FreeSurfer was not found. To use this data, make sure\n' ...
        'that FreeSurfer is correctly installed and configured, and\n' ...
        'that your ''FREESURFER_HOME'' environmental variable is\n' ...
        'properly set.\n' ...
        'File: %s\n'],varargin{1});
end
addpath(fullfile(fshome,'/matlab'));

% Load MGH file
dpx = load_mgh(filemgh);

% Save DPV file
dpxwrite(filedpv,dpx)

